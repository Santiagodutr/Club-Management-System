---
import AdminLayout from '../../layouts/AdminLayout.astro'

export const prerender = false
---

<AdminLayout title="Servicios Adicionales - Club del Meta" active="parametros">
  <section class="panel">
    <header class="panel__header">
      <div>
        <p class="eyebrow">Administración</p>
        <h1>Servicios Adicionales</h1>
        <p class="muted">Gestiona los servicios adicionales disponibles para cotizaciones.</p>
      </div>
      <div class="actions">
        <button id="btnNuevoServicio" class="btn primary">+ Nuevo Servicio</button>
      </div>
    </header>

    <div class="filters-bar">
      <div class="filters">
        <label>
          Estado
          <select id="filtroEstado">
            <option value="">Todos</option>
            <option value="true">Activos</option>
            <option value="false">Inactivos</option>
          </select>
        </label>
      </div>
      <button id="btnRefrescar" class="btn secondary">Refrescar</button>
    </div>

    <section class="card">
      <div class="card__header">
        <div>
          <p class="eyebrow">Servicios</p>
          <h2>Lista de Servicios Adicionales</h2>
        </div>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Descripción</th>
              <th>Precio</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="serviciosList">
            <tr>
              <td colspan="5" class="placeholder">Cargando servicios...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </section>

  <!-- Modal para crear/editar servicio -->
  <div id="modalServicio" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal__header">
        <h3 id="modalTitle">Nuevo Servicio</h3>
        <button id="btnCerrarModal" class="btn-close">×</button>
      </div>
      <div class="modal__body">
        <form id="formServicio">
          <input type="hidden" id="servicioId" />
          
          <label for="nombre">
            Nombre del Servicio *
            <input 
              type="text" 
              id="nombre" 
              required
              placeholder="Ej: Mesero adicional"
            />
          </label>

          <label for="descripcion">
            Descripción
            <textarea 
              id="descripcion" 
              rows="3"
              placeholder="Descripción del servicio (opcional)"
            ></textarea>
          </label>

          <label for="precio">
            Precio *
            <input 
              type="number" 
              id="precio" 
              required
              min="0"
              step="1000"
              placeholder="0"
            />
          </label>

          <label class="checkbox-label">
            <input type="checkbox" id="activo" checked />
            <span>Servicio activo</span>
          </label>
        </form>
      </div>
      <div class="modal__footer">
        <button id="btnCancelar" class="btn ghost">Cancelar</button>
        <button id="btnGuardar" class="btn primary">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmación para eliminar -->
  <div id="modalEliminar" class="modal-overlay hidden">
    <div class="modal-confirm">
      <div class="modal-confirm__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <h3 class="modal-confirm__title">¿Eliminar servicio?</h3>
      <p class="modal-confirm__message">Esta acción no se puede deshacer. El servicio <strong id="servicioEliminarNombre"></strong> será eliminado permanentemente.</p>
      <div class="modal-confirm__actions">
        <button id="btnCancelarEliminar" class="btn ghost">Cancelar</button>
        <button id="btnConfirmarEliminar" class="btn danger">Eliminar</button>
      </div>
    </div>
  </div>

  <!-- Mensajes -->
  <div id="mensajeExito" class="mensaje-exito hidden">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20 6L9 17l-5-5"></path>
    </svg>
    <span id="mensajeExitoTexto">Operación exitosa</span>
  </div>

  <div id="mensajeError" class="mensaje-error hidden">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    <span id="mensajeErrorTexto">Error en la operación</span>
  </div>
</AdminLayout>

<script>
import '@scripts/parametros-adicionales.ts'
</script>

<style>
  /* All base styles come from AdminLayout.astro */
  .panel { width: 100%; max-width: 1400px; }

  .filters-bar {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .filters { display: flex; gap: 1rem; flex: 1; min-width: 0; flex-wrap: wrap; }
  .filters label { min-width: 150px; }

  .table-container { overflow-x: auto; width: 100%; -webkit-overflow-scrolling: touch; }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }

  thead { border-bottom: 1px solid var(--table-border); }

  th {
    text-align: left;
    padding: 0.85rem 1rem;
    font-weight: 700;
    color: var(--text-muted);
    text-transform: uppercase;
    font-size: 0.68rem;
    letter-spacing: 0.08em;
    white-space: nowrap;
    background: var(--table-header);
  }

  th:first-child { padding-left: 1.25rem; }
  th:last-child { text-align: center; }

  :global(tbody tr) { border-bottom: 1px solid var(--table-border); transition: background 0.15s ease; background: transparent; }
  :global(tbody tr:hover) { background: var(--table-hover); }
  :global(tbody tr.inactivo) { opacity: 0.55; }
  :global(tbody tr:last-child) { border-bottom: none; }

  :global(td) { padding: 1.1rem 1rem; color: var(--text); vertical-align: middle; }
  :global(td:first-child) { padding-left: 1.25rem; }

  td.placeholder { text-align: center; color: var(--text-faint); padding: 3rem; font-style: italic; }

  :global(.servicio-nombre) { font-weight: 700; color: var(--text); font-size: 0.95rem; }
  :global(.servicio-descripcion) { color: var(--text-muted); font-size: 0.85rem; max-width: 350px; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.4; margin-top: 0.2rem; }
  :global(.servicio-precio) { font-weight: 600; color: var(--text); font-size: 0.9rem; }
  :global(.servicio-actions) { display: flex; gap: 0.5rem; justify-content: center; align-items: center; flex-wrap: wrap; }

  @media (max-width: 768px) {
    .filters-bar { flex-direction: column; align-items: stretch; }
    .filters { flex-direction: column; width: 100%; }
    .filters label { width: 100%; min-width: 0; }
    table { display: block; overflow-x: auto; }
    th { white-space: normal; }
  }
</style>