---
import AdminLayout from '../../layouts/AdminLayout.astro'
export const prerender = false
---

<AdminLayout title="Reportes - Club del Meta" active="reportes">
  <section class="panel animate-fade-in">
    <header class="panel__header">
      <div class="animate-slide-up" style="animation-delay: 0.1s;">
        <p class="eyebrow">Analítica</p>
        <h1>Reportes de <span class="text-accent">Cotizaciones</span></h1>
        <p class="muted">Visión general del rendimiento por estado, período y salón.</p>
      </div>
      <div class="filters animate-slide-up" style="animation-delay: 0.2s;">
        <div class="filter-group">
          <label for="vistaSelect">Vista</label>
          <select id="vistaSelect">
            <option value="dia">Por día</option>
            <option value="mes">Por mes</option>
            <option value="anio">Por año</option>
          </select>
        </div>
        <div class="filter-group" id="monthSelectorWrap">
          <label for="monthSelect">Mes</label>
          <select id="monthSelect">
            <option value="1">Enero</option><option value="2">Febrero</option>
            <option value="3">Marzo</option><option value="4">Abril</option>
            <option value="5">Mayo</option><option value="6">Junio</option>
            <option value="7">Julio</option><option value="8">Agosto</option>
            <option value="9">Septiembre</option><option value="10">Octubre</option>
            <option value="11">Noviembre</option><option value="12">Diciembre</option>
          </select>
        </div>
        <div class="filter-group" id="yearSelectorWrap">
          <label for="yearSelect">Año</label>
          <select id="yearSelect">
            <option value="">Cargando...</option>
          </select>
        </div>
      </div>
    </header>

    <!-- KPI Grid -->
    <div class="kpi-grid animate-slide-up" style="animation-delay: 0.25s;">
      <article class="kpi-card">
        <div class="kpi-icon kpi-icon--primary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
        <div>
          <p class="kpi-label">Total</p>
          <p class="kpi-value" id="kpiTotal">—</p>
        </div>
      </article>
      <article class="kpi-card">
        <div class="kpi-icon kpi-icon--success">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div>
          <p class="kpi-label">Aprobadas</p>
          <p class="kpi-value kpi-value--success" id="kpiAprobadas">—</p>
        </div>
      </article>
      <article class="kpi-card">
        <div class="kpi-icon kpi-icon--warning">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
        </div>
        <div>
          <p class="kpi-label">Pendientes</p>
          <p class="kpi-value kpi-value--warning" id="kpiPendientes">—</p>
        </div>
      </article>
      <article class="kpi-card">
        <div class="kpi-icon kpi-icon--danger">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </div>
        <div>
          <p class="kpi-label">Rechazadas</p>
          <p class="kpi-value kpi-value--danger" id="kpiRechazadas">—</p>
        </div>
      </article>
    </div>

    <!-- Charts Section -->
    <div class="charts-grid animate-slide-up" style="animation-delay: 0.35s;">
      <article class="card chart-card">
        <div class="card__header">
          <div>
            <p class="eyebrow">Calendario</p>
            <h2 id="chartTitle">Cotizaciones</h2>
          </div>
        </div>
        <div id="calendarGrid" class="calendar-grid"></div>
      </article>

      <article class="card chart-card">
        <div class="card__header">
          <div>
            <p class="eyebrow">Participación por Salón</p>
            <h2>Distribución</h2>
          </div>
          <select id="estadoDonutSelect" style="min-width: 120px; font-size: 0.8rem; max-width: 140px;">
            <option value="todas">Todas</option>
            <option value="aceptada">Aceptadas</option>
            <option value="pendiente">Pendientes</option>
            <option value="rechazada">Rechazadas</option>
          </select>
        </div>
        <div class="donut-wrap">
          <div id="donutChart" class="donut">
            <div class="donut-center">
              <div class="donut-number" id="donutTotal">—</div>
              <div class="donut-label">total</div>
            </div>
          </div>
          <div id="donutLegend" class="legend"></div>
        </div>
      </article>
    </div>
  </section>
</AdminLayout>

<script>
  import '@scripts/reportes.ts'
</script>

<style>
  /* Base */
  .panel { width: 100%; max-width: 1600px; }
  .filters { display: flex; gap: 1rem; align-items: flex-end; flex-wrap: wrap; }
  .filter-group { display: flex; flex-direction: column; gap: 0.4rem; min-width: 120px; }
  .filter-group label { font-size: 0.68rem; }

  /* Animations */
  .animate-fade-in { opacity: 0; animation: fade-in 0.8s ease forwards; }
  .animate-slide-up { opacity: 0; animation: slide-up 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
  @keyframes fade-in { to { opacity: 1; } }
  @keyframes slide-up { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }

  /* KPI Grid */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .kpi-card {
    background: var(--card-bg);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border: 1px solid var(--card-border);
    border-radius: 18px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.25rem;
    box-shadow: var(--shadow);
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }

  .kpi-card:hover { transform: translateY(-3px); box-shadow: 0 30px 60px -15px rgba(0,0,0,0.5); }

  .kpi-icon {
    width: 52px;
    height: 52px;
    border-radius: 14px;
    display: grid;
    place-items: center;
    flex-shrink: 0;
  }

  .kpi-icon svg { width: 24px; height: 24px; }

  .kpi-icon--primary { background: rgba(59, 130, 246, 0.15); color: #93c5fd; border: 1px solid rgba(59, 130, 246, 0.2); }
  .kpi-icon--success { background: rgba(52, 211, 153, 0.15); color: #34d399; border: 1px solid rgba(52, 211, 153, 0.2); }
  .kpi-icon--warning { background: rgba(251, 191, 36, 0.15); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.2); }
  .kpi-icon--danger  { background: rgba(248, 113, 113, 0.15); color: #f87171; border: 1px solid rgba(248, 113, 113, 0.2); }

  /* Light mode KPI icons */
  [data-theme="light"] .kpi-icon--primary { background: #dbeafe; color: #1e40af; }
  [data-theme="light"] .kpi-icon--success { background: #d1fae5; color: #065f46; }
  [data-theme="light"] .kpi-icon--warning { background: #fef3c7; color: #92400e; }
  [data-theme="light"] .kpi-icon--danger  { background: #fee2e2; color: #991b1b; }

  .kpi-label {
    margin: 0;
    font-weight: 700;
    color: var(--text-muted);
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .kpi-value {
    margin: 0.25rem 0 0;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.25rem;
    font-weight: 400;
    color: var(--text);
    letter-spacing: 0.02em;
    line-height: 1;
  }

  .kpi-value--success { color: #34d399; }
  .kpi-value--warning { color: #fbbf24; }
  .kpi-value--danger  { color: #f87171; }
  [data-theme="light"] .kpi-value--success { color: #059669; }
  [data-theme="light"] .kpi-value--warning { color: #b45309; }
  [data-theme="light"] .kpi-value--danger  { color: #dc2626; }

  /* Charts Grid */
  .charts-grid {
    display: grid;
    grid-template-columns: 2fr 1.1fr;
    gap: 1.5rem;
    align-items: stretch;
  }

  .chart-card { min-height: 340px; margin-bottom: 0; }

  /* Calendar Grid */
  .calendar-grid {
    display: grid;
    gap: 0.5rem;
    padding: 0.5rem 0;
    min-height: 280px;
  }

  .calendar-grid.view-dia { grid-template-columns: repeat(7, 1fr); }
  .calendar-grid.view-mes { grid-template-columns: repeat(4, 1fr); }
  .calendar-grid.view-anio { grid-template-columns: repeat(3, 1fr); }

  :global(.cal-cell) {
    background: var(--surface);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    min-height: 80px;
    padding: 0.6rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  :global(.cal-cell:hover) { background: var(--surface-hover); border-color: var(--border-hover); transform: translateY(-2px); }

  :global(.cal-cell.has-data) {
    border-color: rgba(59, 130, 246, 0.4);
    background: rgba(59, 130, 246, 0.06);
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.1);
  }

  :global(.cal-cell.has-data:hover) {
    border-color: var(--primary);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
    transform: translateY(-3px);
  }

  :global(.cal-cell.empty) { opacity: 0.3; cursor: default; border-style: dashed; }
  :global(.cal-cell.empty:hover) { transform: none; box-shadow: none; }

  :global(.cal-label) { font-weight: 700; color: var(--text); font-size: 0.85rem; text-align: center; }
  :global(.cal-count) {
    background: var(--primary);
    color: white;
    font-size: 0.875rem;
    font-weight: 700;
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 0.03em;
    padding: 0.3rem 0.65rem;
    border-radius: 99px;
    min-width: 32px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }

  /* Donut Chart */
  .donut-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 0.5rem 0;
  }

  .donut {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    background: conic-gradient(var(--border) 0deg, var(--border) 360deg);
    display: grid;
    place-items: center;
    position: relative;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  }

  .donut-center {
    width: 130px;
    height: 130px;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 50%;
    display: grid;
    place-items: center;
    text-align: center;
    backdrop-filter: blur(12px);
  }

  .donut-number {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    color: var(--text);
    line-height: 1;
  }

  .donut-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
  }

  .legend {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.5rem;
    width: 100%;
    max-width: 420px;
  }

  :global(.legend-item) {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    justify-content: space-between;
    padding: 0.5rem 0.75rem;
    border-radius: 10px;
    border: 1px solid var(--card-border);
    background: var(--surface);
  }

  :global(.legend-left) { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text); font-weight: 500; }
  :global(.dot) { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
  :global(.legend-perc) { font-weight: 700; color: var(--primary); font-size: 0.85rem; }

  /* Responsive */
  @media (max-width: 1100px) { .charts-grid { grid-template-columns: 1fr; } }

  @media (max-width: 768px) {
    .kpi-grid { grid-template-columns: repeat(2, 1fr); }
    .calendar-grid.view-dia { grid-template-columns: repeat(7, 1fr); }
    .calendar-grid.view-mes { grid-template-columns: repeat(3, 1fr); }
    :global(.cal-cell) { min-height: 60px; }
    .donut { width: 180px; height: 180px; }
    .donut-center { width: 110px; height: 110px; }
  }

  @media (max-width: 480px) {
    .kpi-grid { grid-template-columns: 1fr; }
  }
</style>
