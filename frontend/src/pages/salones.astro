---
import BaseLayout from '../layouts/BaseLayout.astro'

// Deshabilitar prerender para evitar conexión a DB en build time
export const prerender = false

const API_URL = (import.meta.env.PUBLIC_BACKEND_URL || 'http://localhost:3333').replace(/\/$/, '')

// Obtener espacios desde la API
let salonesData = []
try {
  const response = await fetch(`${API_URL}/api/espacios`)
  const result = await response.json()
  
  if (result.success && result.data) {
    // Mapear a estructura compatible
    salonesData = result.data.map((espacio: any) => {
      // Formatear precio con comas y COP
      let precioFormateado = 'Consultar'
      if (espacio.precio_desde) {
        const precio = parseFloat(espacio.precio_desde)
        if (!isNaN(precio)) {
          precioFormateado = new Intl.NumberFormat('es-CO').format(precio) + ' COP'
        }
      }
      
      return {
        id: espacio.id,
        nombre: espacio.nombre,
        slug: espacio.slug,
        subtitulo: espacio.subtitulo || '',
        descripcionCorta: espacio.descripcion || '',
        capacidad: {
          minima: espacio.capacidad_minima || 0,
          maxima: espacio.capacidad_maxima || 0
        },
        imagenes: espacio.imagenes || [],
        precioDesde: precioFormateado,
        destacado: espacio.destacado || false
      }
    })
  }
} catch (error) {
  console.error('Error cargando espacios:', error)
}
---

<BaseLayout title="Nuestros Salones - Club del Meta" fullWidth>
  <section class="salones">
    <header class="salones__header">
      <div class="salones__badge">Elegancia & Exclusividad</div>
      <h1>
        <span class="title-top">NUESTROS</span>
        <span class="title-main">SALONES</span>
      </h1>
      <p>
        Descubre los espacios únicos del Club del Meta. Cada salón tiene su propia personalidad 
        y está diseñado para hacer de tu evento una experiencia memorable en el corazón del llano.
      </p>
    </header>

    <div class="salones-grid">
      {salonesData.map((salon, index) => {
        const imagenPortada = salon.imagenes.find((img: any) => img.es_portada) || salon.imagenes[0]
        const urlPortada = imagenPortada?.url || '/src/assets/millanura.jpg'
        
        return (
        <article class="salon-card" data-destacado={salon.destacado} style={`--card-index: ${index}`}>
          <div class="salon-card__bg" style={`background-image: url(${urlPortada})`}></div>
          <div class="salon-card__glass">
            <div class="salon-card__top">
              {salon.destacado && <span class="salon-card__destacado">Espacio Premium</span>}
              <div class="salon-card__capacidad">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                </svg>
                Hasta {salon.capacidad.maxima}
              </div>
            </div>

            <div class="salon-card__info">
              <h2>{salon.nombre}</h2>
              <p class="salon-card__subtitulo">{salon.subtitulo}</p>
              <p class="salon-card__descripcion">{salon.descripcionCorta}</p>
            </div>

            <div class="salon-card__footer">
              <div class="salon-card__pricing">
                <span class="price-label">Reserva desde</span>
                <span class="price-value">{salon.precioDesde}</span>
              </div>
              <a href={`/salones/${salon.slug}`} class="salon-card__btn">
                <span>Explorar Espacio</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
              </a>
            </div>
          </div>
        </article>
        )
      })}
    </div>
  </section>
</BaseLayout>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;600;700&display=swap');

  .salones {
    padding: 6rem 2rem;
    background: #f8fafc;
    min-height: 100vh;
  }

  .salones__header {
    text-align: center;
    margin-bottom: 6rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .salones__badge {
    display: inline-block;
    padding: 0.5rem 1.25rem;
    background: rgba(10, 75, 165, 0.08);
    color: #0a4ba5;
    border-radius: 99px;
    font-family: 'Outfit', sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin-bottom: 1.5rem;
    animation: fadeInDown 0.8s ease-out;
  }

  .salones__header h1 {
    font-family: 'Bebas Neue', sans-serif;
    line-height: 0.9;
    margin-bottom: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .title-top {
    font-size: clamp(2rem, 5vw, 3rem);
    color: #94a3b8;
    letter-spacing: 0.1em;
  }

  .title-main {
    font-size: clamp(4rem, 12vw, 8rem);
    color: #041a4a;
    letter-spacing: 0.02em;
  }

  .salones__header p {
    font-family: 'Outfit', sans-serif;
    color: #64748b;
    font-size: 1.125rem;
    line-height: 1.6;
    font-weight: 400;
  }

  .salones-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 3rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  .salon-card {
    position: relative;
    height: 600px;
    border-radius: 24px;
    overflow: hidden;
    background: #000;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.8s ease-out forwards;
    animation-delay: calc(var(--card-index) * 0.15s);
  }

  .salon-card__bg {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    transition: transform 1.2s cubic-bezier(0.2, 0, 0.2, 1);
  }

  .salon-card:hover .salon-card__bg {
    transform: scale(1.1);
  }

  .salon-card__glass {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.1) 0%,
      rgba(0, 0, 0, 0.4) 50%,
      rgba(4, 26, 74, 0.9) 100%
    );
    padding: 3rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    z-index: 2;
  }

  .salon-card__top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .salon-card__destacado {
    background: #3b82f6;
    color: white;
    padding: 0.4rem 1rem;
    border-radius: 99px;
    font-family: 'Outfit', sans-serif;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .salon-card__capacidad {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 99px;
    font-family: 'Outfit', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .salon-card__info h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3rem, 6vw, 4.5rem);
    color: white;
    margin: 0 0 0.5rem;
    line-height: 0.95;
    letter-spacing: 0.02em;
  }

  .salon-card__subtitulo {
    font-family: 'Outfit', sans-serif;
    color: #93c5fd;
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .salon-card__descripcion {
    font-family: 'Outfit', sans-serif;
    color: rgba(255, 255, 255, 0.7);
    font-size: 1rem;
    line-height: 1.6;
    max-width: 90%;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .salon-card__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .salon-card__pricing {
    display: flex;
    flex-direction: column;
  }

  .price-label {
    font-family: 'Outfit', sans-serif;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.25rem;
  }

  .price-value {
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    color: white;
    font-weight: 700;
  }

  .salon-card__btn {
    background: white;
    color: #041a4a;
    padding: 1rem 2rem;
    border-radius: 99px;
    font-family: 'Outfit', sans-serif;
    font-size: 0.875rem;
    font-weight: 700;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.3s ease;
  }

  .salon-card__btn:hover {
    background: #3b82f6;
    color: white;
    transform: translateX(5px);
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 1100px) {
    .salones-grid {
      grid-template-columns: 1fr;
      gap: 3rem;
    }
    
    .salon-card {
      height: 500px;
    }
  }

  @media (max-width: 640px) {
    .salones {
      padding: 4rem 1.5rem;
    }

    .salon-card {
      height: 450px;
    }

    .salon-card__glass {
      padding: 2rem;
    }

    .salon-card__info h2 {
      font-size: 3rem;
    }

    .salon-card__footer {
      flex-direction: column;
      align-items: flex-start;
      gap: 1.5rem;
    }

    .salon-card__btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>
